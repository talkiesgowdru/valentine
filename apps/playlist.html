<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Our Playlist | Sanctuary OS</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --bg: #000000;
            --apple-glass: rgba(28, 28, 30, 0.75);
            --accent: #1DB954;
            --border: rgba(255, 255, 255, 0.12);
            --safe-bottom: 180px; 
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100svh;
            font-family: 'Inter', sans-serif;
            background: var(--bg); color: #fff;
            overflow: hidden; -webkit-font-smoothing: antialiased;
        }

        /* Ambient Fluid Engine */
        #canvas { position: fixed; inset: 0; z-index: 1; pointer-events: none; opacity: 0.3; }
        .dynamic-bg { position: fixed; inset: 0; z-index: 0; transition: background 1.5s ease; filter: brightness(0.4) blur(80px); }

        .back-nav {
            position: fixed; top: 20px; left: 20px; z-index: 5001;
            text-decoration: none; color: #fff; display: flex; align-items: center; gap: 10px;
            font-size: 0.65rem; font-weight: 800; text-transform: uppercase; letter-spacing: 2px;
            background: var(--apple-glass); padding: 10px 20px; border-radius: 50px;
            backdrop-filter: blur(20px); border: 1px solid var(--border);
        }

        .app-shell { display: flex; height: 100svh; width: 100%; position: relative; z-index: 10; }

        /* SEPARATE LEFT SCROLL ENGINE */
        .sidebar {
            width: 380px; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(40px);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; flex-shrink: 0; z-index: 20;
        }

        .sidebar-header { padding: 80px 25px 20px; }
        .sidebar-header h2 { font-weight: 900; font-size: 1.8rem; margin: 0; letter-spacing: -1px; }

        .track-list-scroll {
            flex-grow: 1; overflow-y: auto; 
            padding: 10px 15px var(--safe-bottom);
            scrollbar-width: none; -webkit-overflow-scrolling: touch;
        }
        .track-list-scroll::-webkit-scrollbar { display: none; }

        .track-item {
            display: flex; align-items: center; padding: 14px; border-radius: 16px;
            cursor: pointer; transition: 0.3s; margin-bottom: 8px; border: 1px solid transparent;
        }
        .track-item:hover { background: rgba(255,255,255,0.08); }
        .track-item.active { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.1); }
        .track-item.active .track-name { color: var(--accent); }

        .track-thumb { width: 52px; height: 52px; border-radius: 8px; margin-right: 16px; object-fit: cover; }
        .track-meta { min-width: 0; }
        .track-name { font-weight: 700; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .track-artist { font-size: 0.75rem; color: #b3b3b3; margin-top: 4px; }

        /* SEPARATE RIGHT FOCUS STAGE */
        .main-stage {
            flex-grow: 1; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding-bottom: var(--safe-bottom); position: relative;
        }

        .artwork-container {
            width: clamp(280px, 45vh, 450px); aspect-ratio: 1;
            border-radius: 24px; box-shadow: 0 50px 120px rgba(0,0,0,0.9);
            margin-bottom: 40px; overflow: hidden;
            transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .artwork-container img { width: 100%; height: 100%; object-fit: cover; }
        .is-playing .artwork-container { transform: scale(1.05); }

        .song-info { text-align: center; }
        .song-info h1 { font-size: 2.8rem; font-weight: 900; margin: 0; letter-spacing: -2px; }
        .song-info p { font-size: 1.2rem; color: #b3b3b3; margin-top: 10px; }

        /* COMMAND HUD */
        .hud-player {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 900px;
            background: var(--apple-glass); backdrop-filter: blur(50px) saturate(180%);
            border-radius: 35px; border: 1px solid var(--border);
            padding: 22px 35px; display: flex; flex-direction: column; gap: 15px;
            z-index: 5000; box-shadow: 0 40px 100px rgba(0,0,0,1);
        }

        .controls { display: flex; align-items: center; justify-content: center; gap: 35px; }
        .btn { cursor: pointer; font-size: 1.3rem; opacity: 0.6; transition: 0.3s; }
        .btn:hover { opacity: 1; color: var(--accent); transform: scale(1.1); }
        .btn-play { width: 56px; height: 56px; background: #fff; color: #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; opacity: 1; }
        
        .scrubber { display: flex; align-items: center; gap: 15px; width: 100%; }
        .time { font-size: 0.75rem; color: #8e8e93; font-variant-numeric: tabular-nums; min-width: 45px; }
        .rail { flex-grow: 1; height: 5px; background: rgba(255,255,255,0.1); border-radius: 10px; cursor: pointer; position: relative; }
        .fill { height: 100%; background: var(--accent); border-radius: 10px; width: 0%; box-shadow: 0 0 10px var(--accent); }
        .hud-active { color: var(--accent) !important; opacity: 1 !important; }

        @media (max-width: 900px) {
            .app-shell { flex-direction: column; }
            .sidebar { width: 100%; height: 45%; border-right: none; border-bottom: 1px solid var(--border); }
            .main-stage { height: 55%; }
            .artwork-container { width: 200px; }
            .song-info h1 { font-size: 1.5rem; }
            .hud-player { width: 95%; bottom: 20px; padding: 15px 20px; }
        }
    </style>
</head>
<body onkeydown="handleKeys(event)">

    <div class="dynamic-bg" id="bgLayer"></div>
    <canvas id="canvas"></canvas>

    <a href="../apps.html" class="back-nav"><i class="fas fa-chevron-left"></i> Sanctuary</a>

    <div class="app-shell" id="shell">
        <aside class="sidebar">
            <div class="sidebar-header"><h2>Our Playlist</h2></div>
            <div class="track-list-scroll" id="trackList"></div>
        </aside>

        <main class="main-stage">
            <div class="artwork-container">
                <img id="pArt" src="">
            </div>
            <div class="song-info">
                <h1 id="pName">Sanctuary Audio</h1>
                <p id="pArtist"></p>
            </div>
        </main>
    </div>

    <footer class="hud-player">
        <div class="controls">
            <i class="fas fa-shuffle btn" id="hShuf" onclick="toggleShuffle()"></i>
            <i class="fas fa-undo btn" onclick="skip(-15)"></i>
            <i class="fas fa-backward-step btn" onclick="changeTrack(-1)"></i>
            <div class="btn-play btn" onclick="toggleAudio()"><i class="fas fa-play" id="hPlay"></i></div>
            <i class="fas fa-forward-step btn" onclick="changeTrack(1)"></i>
            <i class="fas fa-redo btn" onclick="skip(15)"></i>
            <i class="fas fa-repeat btn" id="hRep" onclick="toggleRepeat()"></i>
        </div>
        <div class="scrubber">
            <span class="time" id="curr">0:00</span>
            <div class="rail" onclick="manualScrub(event)"><div class="fill" id="fill"></div></div>
            <span class="time" id="dur">0:00</span>
        </div>
    </footer>

    <audio id="masterAudio" preload="auto"></audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        const playlist = [
            { id: 0, name: "Telephone Gelathi", artist: "Rajesh Krishnan", file: "track1.mp3", cover: "track1.jpg", accent: "#ff3b30" },
            { id: 1, name: "Naane Neenanthe", artist: "Sid Sriram & Lahari Mahesh", file: "track2.mp3", cover: "track2.jpeg", accent: "#5856d6" },
            { id: 2, name: "Mungaru Maleyalli", artist: "Sid Sriram", file: "track3.mp3", cover: "track3.jpg", accent: "#1DB954" },
            { id: 3, name: "Yaare Yaare", artist: "Armaan Malik", file: "track4.mp3", cover: "track4.jpg", accent: "#007aff" },
            { id: 4, name: "Yenappa Sangathi", artist: "Tippu", file: "track5.mp3", cover: "track5.jpeg", accent: "#af52de" },
            { id: 5, name: "Mr. & Mrs. Ramachari", artist: "Tippu", file: "track6.mp3", cover: "track5.jpeg", accent: "#fbc02d" }
        ];

        let currentId = 0, isShuffle = false, isRepeat = false;
        const audio = document.getElementById('masterAudio');

        function initUI() {
            const container = document.getElementById('trackList');
            container.innerHTML = '';
            
            // Spatial Separation Logic for duplicated art
            let displayOrder = [...playlist];
            const duplicate = displayOrder.splice(5, 1)[0]; 
            displayOrder.splice(0, 0, duplicate);

            displayOrder.forEach(t => {
                const el = document.createElement('div');
                el.className = `track-item ${t.id === currentId ? 'active' : ''}`;
                el.onclick = () => loadTrack(t.id);
                el.innerHTML = `
                    <img class="track-thumb" src="${t.cover}">
                    <div class="track-meta">
                        <div class="track-name">${t.name}</div>
                        <div class="track-artist">${t.artist}</div>
                    </div>`;
                container.appendChild(el);
            });
        }

        // BOOT PROTOCOL: Surgical pre-load of first track to prevent blank state
        function bootSanctuary() {
            const t = playlist[0];
            document.getElementById('pName').innerText = t.name;
            document.getElementById('pArtist').innerText = t.artist;
            document.getElementById('pArt').src = t.cover;
            document.getElementById('bgLayer').style.background = `radial-gradient(circle at center, ${t.accent} 0%, #000 100%)`;
            audio.src = t.file;
            initUI();
        }

        function loadTrack(id) {
            currentId = id; const t = playlist[id];
            document.getElementById('pName').innerText = t.name;
            document.getElementById('pArtist').innerText = t.artist;
            document.getElementById('pArt').src = t.cover;
            document.getElementById('bgLayer').style.background = `radial-gradient(circle at center, ${t.accent} 0%, #000 100%)`;
            audio.src = t.file;
            initUI(); toggleAudio(true);
            gsap.fromTo("#pArt", {scale: 0.9, opacity: 0}, {scale: 1, opacity: 1, duration: 1, ease: "expo.out"});
        }

        function toggleAudio(force = false) {
            const icon = document.getElementById('hPlay');
            if (audio.paused || force) {
                audio.play().catch(() => {});
                icon.className = "fas fa-pause";
                document.getElementById('shell').classList.add('is-playing');
            } else {
                audio.pause();
                icon.className = "fas fa-play";
                document.getElementById('shell').classList.remove('is-playing');
            }
        }

        function changeTrack(dir) {
            if(isShuffle && dir > 0) currentId = Math.floor(Math.random()*playlist.length);
            else currentId = (currentId + dir + playlist.length) % playlist.length;
            loadTrack(currentId);
        }

        function skip(val) { audio.currentTime += val; }
        function toggleShuffle() { isShuffle = !isShuffle; document.getElementById('hShuf').classList.toggle('hud-active', isShuffle); }
        function toggleRepeat() { isRepeat = !isRepeat; audio.loop = isRepeat; document.getElementById('hRep').classList.toggle('hud-active', isRepeat); }
        function manualScrub(e) { const rect = e.currentTarget.getBoundingClientRect(); audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration; }

        audio.ontimeupdate = () => {
            const p = (audio.currentTime / audio.duration) * 100;
            document.getElementById('fill').style.width = p + '%';
            document.getElementById('curr').innerText = formatTime(audio.currentTime);
            document.getElementById('dur').innerText = formatTime(audio.duration);
        };

        function formatTime(s) {
            if (isNaN(s)) return "0:00";
            const m = Math.floor(s/60); const sec = Math.floor(s%60);
            return `${m}:${sec < 10 ? '0' : ''}${sec}`;
        }

        function handleKeys(e) {
            if(e.code === "Space") { e.preventDefault(); toggleAudio(); }
            if(e.code === "ArrowRight") skip(15);
            if(e.code === "ArrowLeft") skip(-15);
        }

        audio.onended = () => { if(!isRepeat) changeTrack(1); };

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        let pts = [];
        class P { constructor() { this.x=Math.random()*canvas.width; this.y=Math.random()*canvas.height; this.s=Math.random()*1.5; this.v=Math.random()*0.2; } upd(){this.y-=this.v; if(this.y<0)this.y=canvas.height;} drw(){ctx.globalAlpha=0.15; ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(this.x,this.y,this.s,0,Math.PI*2); ctx.fill();}}
        for(let i=0; i<60; i++) pts.push(new P());
        function render() { ctx.clearRect(0,0,canvas.width,canvas.height); pts.forEach(p=>{p.upd();p.drw();}); requestAnimationFrame(render); } render();

        // RUN BOOT
        window.onload = bootSanctuary;
    </script>
</body>
</html>